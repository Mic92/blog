<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.110.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta property="og:title" content="Global Request Management With Restkit"><meta property="og:title" content="Global Request Management With Restkit"><meta property="og:description" content="For our latest iOS app we are using RestKit Framework, which is a really great and advanced library to communicate to your REST API.
When you have lots of requests in different areas of your project, you may want to have a global handling for failure events. For example how an Login View, if any of the requests gives you an 401 (Unauthorized) status code.
In RestKit 0.20 they introduced the opportunity to register your own RKObjectRequestOperation, which is the common way to do this."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.thalheim.io/2013/09/03/global-request-management-with-restkit/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-09-03T00:00:00+00:00"><meta property="article:modified_time" content="2013-09-03T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Global Request Management With Restkit"><meta name=twitter:description content="For our latest iOS app we are using RestKit Framework, which is a really great and advanced library to communicate to your REST API.
When you have lots of requests in different areas of your project, you may want to have a global handling for failure events. For example how an Login View, if any of the requests gives you an 401 (Unauthorized) status code.
In RestKit 0.20 they introduced the opportunity to register your own RKObjectRequestOperation, which is the common way to do this."><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><title>Global Request Management With Restkit | ~/git/blog</title><script data-goatcounter=https://goatcounter.thalheim.io/count async src=https://goatcounter.thalheim.io/count.js></script></head><body><header><div id=titletext><h2 id=title><a href=https://blog.thalheim.io/>~/git/blog</a></h2></div><div id=title-description><p id=subtitle>My brain-dump of random code/configuration.</p><div id=social><nav><ul><li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li><li><a href=https://github.com/Mic92/blog><i title=Github class="icons fab fa-github"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All Posts</a></li><li><a href=/categories>Categories</a></li></ul></nav></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>03</span>
<span class=rest>Sep 2013</span></div></div><div class=matter><h1 class=title>Global Request Management With Restkit</h1></div></div><div class=markdown><p>For our latest iOS app we are using <a href=http://restkit.org target=_blank>RestKit Framework</a>,
which is a really great and advanced library to communicate to your REST API.</p><p>When you have lots of requests in different areas of your project, you may want
to have a global handling for failure events. For example how an Login View, if
any of the requests gives you an 401 (Unauthorized) status code.</p><p>In RestKit 0.20 they introduced the opportunity to register your own
<code>RKObjectRequestOperation</code>, which is the common way to do this.</p><p>So at first you create a subclass of <code>RKObjectRequestOperation</code>, let&rsquo;s call it
<code>CustomRKObjectRequestOperation</code></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objective-c data-lang=objective-c><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#import &#34;RKObjectRequestOperation.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>@interface</span> <span style=color:#458;font-weight:700>CustomRKObjectRequestOperation</span> : <span style=color:#458;font-weight:700>RKObjectRequestOperation</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>@end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>@implementation</span> <span style=color:#458;font-weight:700>CustomRKObjectRequestOperation</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#458;font-weight:700>void</span>)<span style=color:#900;font-weight:700>setCompletionBlockWithSuccess:</span>(<span style=color:#458;font-weight:700>void</span> ( <span style=color:#000;font-weight:700>^</span> ) ( RKObjectRequestOperation <span style=color:#000;font-weight:700>*</span>operation , RKMappingResult <span style=color:#000;font-weight:700>*</span>mappingResult ))<span style=color:teal>success</span> <span style=color:#900;font-weight:700>failure:</span>(<span style=color:#458;font-weight:700>void</span> ( <span style=color:#000;font-weight:700>^</span> ) ( RKObjectRequestOperation <span style=color:#000;font-weight:700>*</span>operation , NSError <span style=color:#000;font-weight:700>*</span>error ))<span style=color:teal>failure</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    [<span style=color:#0086b3>super</span> <span style=color:#900;font-weight:700>setCompletionBlockWithSuccess</span>:<span style=color:#000;font-weight:700>^</span><span style=color:#458;font-weight:700>void</span>(RKObjectRequestOperation <span style=color:#000;font-weight:700>*</span>operation , RKMappingResult <span style=color:#000;font-weight:700>*</span>mappingResult) {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>if</span> (success) {
</span></span><span style=display:flex><span>            success(operation, mappingResult);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }<span style=color:#900;font-weight:700>failure</span>:<span style=color:#000;font-weight:700>^</span><span style=color:#458;font-weight:700>void</span>(RKObjectRequestOperation <span style=color:#000;font-weight:700>*</span>operation , NSError <span style=color:#000;font-weight:700>*</span>error) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        [[NSNotificationCenter defaultCenter] <span style=color:#900;font-weight:700>postNotificationName</span>:<span style=color:#d14>@&#34;connectionFailure&#34;</span> <span style=color:#900;font-weight:700>object</span>:operation];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>if</span> (failure) {
</span></span><span style=display:flex><span>            failure(operation, error);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>@end</span>
</span></span></code></pre></div><p>This is the point where we overwrite the method which sets the completion and
failure block. I use the Observer Pattern (<code>NSNotificationCenter</code>) to notify
about connectionFailures.
(<a href=http://mobile.tutsplus.com/tutorials/iphone/ios-sdk_nsnotificationcenter/ target=_blank>Learn more about NSNotificationCenter</a>)</p><p>Of course we need to tell RestKit to use our custom <code>RKObjectRequestOperation</code>
class. You can do this by adding this line to you RestKit configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objective-c data-lang=objective-c><span style=display:flex><span>[[RKObjectManager sharedManager] <span style=color:#900;font-weight:700>registerRequestOperationClass</span>:[CustomRKObjectRequestOperation <span style=color:#000;font-weight:700>class</span>]];
</span></span></code></pre></div><p>Now we need a class where we listen to the failure notifications. You can choose
any of your class, I use the AppDelegate for this.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objective-c data-lang=objective-c><span style=display:flex><span>[[NSNotificationCenter defaultCenter] <span style=color:#900;font-weight:700>addObserver</span>:<span style=color:#0086b3>self</span> <span style=color:#900;font-weight:700>selector</span>:<span style=color:#000;font-weight:700>@selector</span>(<span style=color:#900;font-weight:700>connectionFailedWithOperation</span>:) <span style=color:#900;font-weight:700>name</span>:<span style=color:#d14>@&#34;connectionFailure&#34;</span> <span style=color:#900;font-weight:700>object</span>:<span style=color:#0086b3>nil</span>];
</span></span></code></pre></div><p>As you should know, the <code>connectionFailedWithOperation:</code> is called when a
connection failure occurs.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objective-c data-lang=objective-c><span style=display:flex><span>- (<span style=color:#458;font-weight:700>void</span>)<span style=color:#900;font-weight:700>connectionFailedWithOperation:</span>(NSNotification <span style=color:#000;font-weight:700>*</span>)<span style=color:teal>notification</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    RKObjectRequestOperation <span style=color:#000;font-weight:700>*</span>operation <span style=color:#000;font-weight:700>=</span> (RKObjectRequestOperation <span style=color:#000;font-weight:700>*</span>)notification.object;
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>if</span> (operation) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        NSInteger statusCode <span style=color:#000;font-weight:700>=</span> operation.HTTPRequestOperation.response.statusCode;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>switch</span> (statusCode) {
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>case</span> <span style=color:#099>0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#998;font-style:italic>// No internet connection
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>            {
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>case</span>  <span style=color:#099>401</span><span style=color:#000;font-weight:700>:</span> <span style=color:#998;font-style:italic>// not authenticated
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>            {
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Links:<br><a href=http://restkit.org target=_blank>RestKit Framework</a><br><a href=http://restkit.org/api/latest/Classes/RKObjectRequestOperation.html target=_blank>Class Documentation for RKObjectRequestOperation</a></p><p><em>by Albert Schulz</em><br>If you have any questions feel free to contact me:<br>eMail: <a href=mailto:mail@halfco.de>mail@halfco.de</a><br>Twitter: <a href=https://twitter.com/albert_sn target=_blank>@albert_sn</a><br>Web: <a href=http://halfco.de target=_blank>halfco.de</a></p></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//mic92.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer>© 2021 Jörg Thalheim</footer></body></html>